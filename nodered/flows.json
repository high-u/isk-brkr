[
    {
        "id": "7583fe25.07e35",
        "type": "tab",
        "label": "API-Stream-JSON",
        "disabled": false,
        "info": ""
    },
    {
        "id": "3bdd7169.8f727e",
        "type": "tab",
        "label": "API-Upload-Binary",
        "disabled": false,
        "info": ""
    },
    {
        "id": "1cd6cc46.11b024",
        "type": "aws-sdk-anything-config",
        "z": "",
        "name": "AWS",
        "region": "ap-northeast-1"
    },
    {
        "id": "f9509aab.b5a348",
        "type": "debug",
        "z": "7583fe25.07e35",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 1110,
        "y": 176,
        "wires": []
    },
    {
        "id": "cede21a.782efe",
        "type": "http in",
        "z": "7583fe25.07e35",
        "name": "",
        "url": "/v1/stream/json",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 158,
        "y": 128,
        "wires": [
            [
                "2f54f60d.c145ba",
                "f9509aab.b5a348",
                "2f9dfce3.2963c4"
            ]
        ]
    },
    {
        "id": "74e544b4.82986c",
        "type": "comment",
        "z": "7583fe25.07e35",
        "name": "Real Time API",
        "info": "",
        "x": 118,
        "y": 96,
        "wires": []
    },
    {
        "id": "2f54f60d.c145ba",
        "type": "http response",
        "z": "7583fe25.07e35",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 898,
        "y": 128,
        "wires": []
    },
    {
        "id": "6339f5ea.52410c",
        "type": "function",
        "z": "7583fe25.07e35",
        "name": "transform",
        "func": "var paramsFirehose = {};\nparamsFirehose.payload = {\n  DeliveryStreamName: msg.deliveryStreamName,\n  Record: {Data: JSON.stringify(msg.payload) + \"\\n\"}  // \\n : for athena\n};\n\nreturn paramsFirehose;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 428,
        "y": 336,
        "wires": [
            [
                "83b354f6.76cf88"
            ]
        ]
    },
    {
        "id": "b49ed9b9.85edc8",
        "type": "debug",
        "z": "7583fe25.07e35",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 1090,
        "y": 336,
        "wires": []
    },
    {
        "id": "bc0b1ebf.0d579",
        "type": "comment",
        "z": "3bdd7169.8f727e",
        "name": "Batch API",
        "info": "",
        "x": 140,
        "y": 96,
        "wires": []
    },
    {
        "id": "319d53a8.9ed10c",
        "type": "http in",
        "z": "3bdd7169.8f727e",
        "name": "",
        "url": "/v1/upload/binary",
        "method": "post",
        "upload": true,
        "swaggerDoc": "",
        "x": 200,
        "y": 144,
        "wires": [
            [
                "c7cfb41a.a72468",
                "522e18df.daf638"
            ]
        ]
    },
    {
        "id": "5d97ceb8.cfc21",
        "type": "debug",
        "z": "3bdd7169.8f727e",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 898,
        "y": 256,
        "wires": []
    },
    {
        "id": "1307564a.6e329a",
        "type": "function",
        "z": "3bdd7169.8f727e",
        "name": "make params",
        "func": "var base64data = msg.req.files[0].buffer;\n\nmsg.payload = {\n    Bucket: msg.binaryBucketName,\n    Key: msg.req.files[0].originalname,\n    Body: base64data,\n    ContentType: msg.req.files[0].mimetype,\n    ContentLength: base64data.length //,\n    // ContentEncoding: 'base64',\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 528,
        "y": 256,
        "wires": [
            [
                "acb39069.97b1c"
            ]
        ]
    },
    {
        "id": "c7cfb41a.a72468",
        "type": "http response",
        "z": "3bdd7169.8f727e",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1026,
        "y": 144,
        "wires": []
    },
    {
        "id": "83b354f6.76cf88",
        "type": "aws-sdk-anything",
        "z": "7583fe25.07e35",
        "aws": "1cd6cc46.11b024",
        "region": "",
        "servicename": "Firehose",
        "methodname": "putRecord",
        "operation": "",
        "name": "",
        "x": 638,
        "y": 336,
        "wires": [
            [
                "b49ed9b9.85edc8"
            ]
        ]
    },
    {
        "id": "acb39069.97b1c",
        "type": "aws-sdk-anything",
        "z": "3bdd7169.8f727e",
        "aws": "1cd6cc46.11b024",
        "region": "",
        "servicename": "S3",
        "methodname": "putObject",
        "name": "",
        "x": 730,
        "y": 256,
        "wires": [
            [
                "5d97ceb8.cfc21"
            ]
        ]
    },
    {
        "id": "f4fe68a9.bb7f98",
        "type": "batch",
        "z": "7583fe25.07e35",
        "name": "batch",
        "mode": "interval",
        "count": 10,
        "overlap": 0,
        "interval": "6",
        "allowEmptySequence": false,
        "topics": [],
        "x": 418,
        "y": 448,
        "wires": [
            [
                "62dbdaa9.940604"
            ]
        ]
    },
    {
        "id": "62dbdaa9.940604",
        "type": "join",
        "z": "7583fe25.07e35",
        "name": "join",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 562,
        "y": 448,
        "wires": [
            [
                "5d2fef82.9fbae"
            ]
        ]
    },
    {
        "id": "f652b909.506c28",
        "type": "aws-sdk-anything",
        "z": "7583fe25.07e35",
        "aws": "1cd6cc46.11b024",
        "region": "",
        "servicename": "Lambda",
        "methodname": "invoke",
        "operation": "",
        "name": "",
        "x": 900,
        "y": 448,
        "wires": [
            [
                "9668e373.0290b"
            ]
        ]
    },
    {
        "id": "9668e373.0290b",
        "type": "debug",
        "z": "7583fe25.07e35",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 1110,
        "y": 448,
        "wires": []
    },
    {
        "id": "5d2fef82.9fbae",
        "type": "function",
        "z": "7583fe25.07e35",
        "name": "transform",
        "func": "var params = {\n  ClientContext: \"MyApp\", \n  FunctionName: msg.streamFunctionName, \n  InvocationType: \"Event\", \n  LogType: \"Tail\", \n  Payload: JSON.stringify(msg.payload)\n};\n\nmsg.payload = params;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 700,
        "y": 448,
        "wires": [
            [
                "f652b909.506c28"
            ]
        ]
    },
    {
        "id": "52ba2307.61ccdc",
        "type": "comment",
        "z": "7583fe25.07e35",
        "name": "TEST",
        "info": "",
        "x": 114,
        "y": 512,
        "wires": []
    },
    {
        "id": "d4dd0290.8e68a",
        "type": "comment",
        "z": "7583fe25.07e35",
        "name": "for firehose",
        "info": "",
        "x": 428,
        "y": 304,
        "wires": []
    },
    {
        "id": "580ccc4e.4a5134",
        "type": "comment",
        "z": "7583fe25.07e35",
        "name": "for enebular lambda",
        "info": "",
        "x": 458,
        "y": 416,
        "wires": []
    },
    {
        "id": "4e2732d0.201f6c",
        "type": "www-request",
        "z": "7583fe25.07e35",
        "name": "call influxdb api",
        "method": "POST",
        "ret": "txt",
        "url": "",
        "follow-redirects": true,
        "tls": "",
        "x": 736,
        "y": 224,
        "wires": [
            [
                "5073403b.5e5a3"
            ]
        ]
    },
    {
        "id": "5073403b.5e5a3",
        "type": "debug",
        "z": "7583fe25.07e35",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 1110,
        "y": 224,
        "wires": []
    },
    {
        "id": "fcbc6146.005e9",
        "type": "function",
        "z": "7583fe25.07e35",
        "name": "transform",
        "func": "var time = new Date().getTime();\n\nvar obj = JSON.parse(msg.payload);\nvar fields = \"\";\nvar tags = \"\";\nvar delim = \"\";\nfor (let k in obj) {\n  let v = obj[k];\n  if (typeof v === \"string\") {\n    tags += `,${k}=${v}`;\n  } else {\n    fields += `${delim}${k}=${v}`;\n    delim = \",\";\n  }\n}\n\nvar series = \"devices\";\n\nmsg.payload = `${series}${tags} ${fields} ${time}`;\nmsg.headers = {\"content-type\": \"application/octet-stream\"};\nmsg.url = msg.influxdbApiWriteUrl;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 428,
        "y": 224,
        "wires": [
            [
                "4e2732d0.201f6c"
            ]
        ]
    },
    {
        "id": "8011ee26.798b9",
        "type": "comment",
        "z": "7583fe25.07e35",
        "name": "for influxdb",
        "info": "",
        "x": 428,
        "y": 192,
        "wires": []
    },
    {
        "id": "8591a663.c034f8",
        "type": "inject",
        "z": "7583fe25.07e35",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 156,
        "y": 560,
        "wires": [
            [
                "eef7ec0.4c81118"
            ]
        ]
    },
    {
        "id": "3c3a4bf6.00b0d4",
        "type": "template",
        "z": "7583fe25.07e35",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "text",
        "syntax": "mustache",
        "template": "{\n    \"gid\": \"G1\",\n    \"sid\": \"S1\",\n    \"val\": {{{value}}}\n}",
        "output": "str",
        "x": 172,
        "y": 720,
        "wires": [
            [
                "37ce9f38.7222"
            ]
        ]
    },
    {
        "id": "c3dde490.9a9588",
        "type": "function",
        "z": "7583fe25.07e35",
        "name": "",
        "func": "var t = new Date().getTime();\nmsg.value = Number(String(t).slice(8, -1)) / 100 + 20;\nmsg.url = \"https://broker.piyopiyo.takeiteasy.link\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 162,
        "y": 672,
        "wires": [
            [
                "3c3a4bf6.00b0d4"
            ]
        ]
    },
    {
        "id": "37ce9f38.7222",
        "type": "http request",
        "z": "7583fe25.07e35",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "url": "",
        "tls": "",
        "x": 342,
        "y": 688,
        "wires": [
            [
                "4478f695.9b8ab8"
            ]
        ]
    },
    {
        "id": "4478f695.9b8ab8",
        "type": "debug",
        "z": "7583fe25.07e35",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 422,
        "y": 752,
        "wires": []
    },
    {
        "id": "e383e3ba.31052",
        "type": "http in",
        "z": "3bdd7169.8f727e",
        "name": "",
        "url": "/test/upload/binary",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 200,
        "y": 368,
        "wires": [
            [
                "3c954ed4.32bcc2"
            ]
        ]
    },
    {
        "id": "a95f3d9e.c3962",
        "type": "template",
        "z": "3bdd7169.8f727e",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<form action=\"http://{{{brokerUrl}}}/api/v1/upload/binary\" method=\"POST\" enctype=\"multipart/form-data\">\n    <input type=\"file\" name=\"myFile\" />\n    <input type=\"submit\" value=\"Submit\">\n</form>",
        "x": 636,
        "y": 368,
        "wires": [
            [
                "97f9fe5e.dbad2"
            ]
        ]
    },
    {
        "id": "97f9fe5e.dbad2",
        "type": "http response",
        "z": "3bdd7169.8f727e",
        "name": "",
        "x": 802,
        "y": 368,
        "wires": []
    },
    {
        "id": "59b5d2fc.62e42c",
        "type": "comment",
        "z": "3bdd7169.8f727e",
        "name": "TEST",
        "info": "",
        "x": 130,
        "y": 336,
        "wires": []
    },
    {
        "id": "ad833357.55651",
        "type": "inject",
        "z": "7583fe25.07e35",
        "name": "",
        "topic": "",
        "payload": "35.627639,139.73652",
        "payloadType": "str",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "x": 580,
        "y": 576,
        "wires": [
            [
                "50558231.d94eac"
            ]
        ]
    },
    {
        "id": "dc15fa0a.26ee48",
        "type": "function",
        "z": "7583fe25.07e35",
        "name": "",
        "func": "var t = new Date().getTime();\nmsg.payload = {\n    time: t,\n    geohash: msg.payload,\n    hostname: \"local\",\n    location: \"Tokyo\",\n    value: 6\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 882,
        "y": 672,
        "wires": [
            [
                "76c553c9.564bfc"
            ]
        ]
    },
    {
        "id": "50558231.d94eac",
        "type": "geohash",
        "z": "7583fe25.07e35",
        "name": "",
        "property": "payload",
        "x": 722.3238983154297,
        "y": 637.7585391998291,
        "wires": [
            [
                "dc15fa0a.26ee48",
                "e64f5699.020718"
            ]
        ]
    },
    {
        "id": "e64f5699.020718",
        "type": "geohash",
        "z": "7583fe25.07e35",
        "name": "",
        "property": "payload",
        "x": 902,
        "y": 624,
        "wires": [
            [
                "76c553c9.564bfc"
            ]
        ]
    },
    {
        "id": "76c553c9.564bfc",
        "type": "debug",
        "z": "7583fe25.07e35",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 1062,
        "y": 656,
        "wires": []
    },
    {
        "id": "3e02b512.44039a",
        "type": "random",
        "z": "7583fe25.07e35",
        "name": "",
        "low": "0",
        "high": "100",
        "inte": "true",
        "property": "value1",
        "x": 428,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "2f9dfce3.2963c4",
        "type": "change",
        "z": "7583fe25.07e35",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "influxdbApiWriteUrl",
                "pt": "msg",
                "to": "https://db.piyopiyo.takeiteasy.link/write?db=iotstartkit&precision=ms",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "deliveryStreamName",
                "pt": "msg",
                "to": "iot-start-kit-delivery-stream",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "streamFunctionName",
                "pt": "msg",
                "to": "IoT-Start-Kit-Particle-Function",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "dataExpireS",
                "pt": "msg",
                "to": "DATA_EXPIRE_S",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "streamWindow",
                "pt": "msg",
                "to": "STREAM_WINDOW_S",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 192,
        "y": 224,
        "wires": [
            [
                "f4fe68a9.bb7f98",
                "6339f5ea.52410c",
                "fcbc6146.005e9"
            ]
        ]
    },
    {
        "id": "522e18df.daf638",
        "type": "change",
        "z": "3bdd7169.8f727e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "binaryBucketName",
                "pt": "msg",
                "to": "higuchi-test-to-20180331",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "exportCsvBucketName",
                "pt": "msg",
                "to": "EXPORT_CSV_BUCKET_NAME",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "urlExpireS",
                "pt": "msg",
                "to": "URL_EXPIRE_S",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "dataExpireS",
                "pt": "msg",
                "to": "DATA_EXPIRE_S",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "streamWindow",
                "pt": "msg",
                "to": "STREAM_WINDOW_S",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 304,
        "y": 256,
        "wires": [
            [
                "1307564a.6e329a"
            ]
        ]
    },
    {
        "id": "3c954ed4.32bcc2",
        "type": "change",
        "z": "3bdd7169.8f727e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "brokerUrl",
                "pt": "msg",
                "to": "nodered1201-dev.yzxq2qpgsp.us-east-1.elasticbeanstalk.com",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 458,
        "y": 368,
        "wires": [
            [
                "a95f3d9e.c3962"
            ]
        ]
    },
    {
        "id": "eef7ec0.4c81118",
        "type": "change",
        "z": "7583fe25.07e35",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "https://broker.piyopiyo.takeiteasy.link/v1/stream/json",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 166,
        "y": 624,
        "wires": [
            [
                "c3dde490.9a9588"
            ]
        ]
    }
]
